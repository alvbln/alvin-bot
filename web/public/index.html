<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Alvin Bot â€” Dashboard</title>
<link rel="stylesheet" href="/css/style.css">
</head>
<body>

<div class="drop-overlay" id="drop-overlay">ğŸ“ Datei hier ablegen</div>

<div class="sidebar">
  <div class="sidebar-header">
    <h1>ğŸ¤– <span>Alvin Bot</span></h1>
    <div class="status" id="bot-status"><span class="status-dot offline"></span> Connecting...</div>
  </div>
  <div class="nav">
    <div class="nav-section">Main</div>
    <div class="nav-item active" data-page="chat">ğŸ’¬ <span>Chat</span></div>
    <div class="nav-item" data-page="dashboard">ğŸ“Š <span>Dashboard</span></div>

    <div class="nav-section">AI</div>
    <div class="nav-item" data-page="models">ğŸ¤– <span>Models</span></div>
    <div class="nav-item" data-page="personality">ğŸ­ <span>Personality</span></div>

    <div class="nav-section">Data</div>
    <div class="nav-item" data-page="memory">ğŸ§  <span>Memory</span></div>
    <div class="nav-item" data-page="sessions">ğŸ“‹ <span>Sessions</span></div>
    <div class="nav-item" data-page="files">ğŸ“ <span>Files</span></div>

    <div class="nav-section">System</div>
    <div class="nav-item" data-page="cron">â° <span>Cron</span></div>
    <div class="nav-item" data-page="tools">ğŸ› ï¸ <span>Tools</span></div>
    <div class="nav-item" data-page="plugins">ğŸ”Œ <span>Plugins</span></div>
    <div class="nav-item" data-page="platforms">ğŸ“± <span>Platforms</span></div>
    <div class="nav-item" data-page="users">ğŸ‘¥ <span>Users</span></div>
    <div class="nav-item" data-page="terminal">ğŸ’» <span>Terminal</span></div>
    <div class="nav-item" data-page="maintenance">ğŸ©º <span>Maintenance</span></div>
    <div class="nav-item" data-page="settings">âš™ï¸ <span>Settings</span></div>
  </div>
  <div class="sidebar-footer">
    <button onclick="toggleTheme()" title="Theme wechseln">ğŸŒ“ <span>Theme</span></button>
    <button onclick="resetChat()" title="Neue Session (âŒ˜N)">ğŸ”„ <span>Reset</span></button>
  </div>
</div>

<div class="main">
  <div class="topbar">
    <h2 id="page-title">ğŸ’¬ Chat</h2>
    <div class="topbar-right">
      <span class="badge badge-accent" id="model-badge">loading...</span>
    </div>
  </div>

  <!-- Chat Page -->
  <div class="page chat-container active" id="page-chat">
    <div class="chat-header">
      <span style="color:var(--fg2);font-size:0.8em">Model:</span>
      <select id="chat-model" onchange="switchModel(this.value)"></select>
      <span style="color:var(--fg2);font-size:0.8em;margin-left:8px">Effort:</span>
      <select id="chat-effort">
        <option value="low">Low</option>
        <option value="medium">Medium</option>
        <option value="high" selected>High</option>
        <option value="max">Max</option>
      </select>
      <div style="flex:1"></div>
      <button class="btn btn-sm btn-outline" onclick="exportChat('markdown')" title="âŒ˜â‡§E">ğŸ“¥ Export</button>
      <button class="btn btn-sm btn-outline" onclick="exportChat('json')">JSON</button>
    </div>
    <div class="messages" id="messages">
      <div class="msg system">Willkommen bei Alvin Bot! Schreib etwas um zu beginnen. ğŸ¤–</div>
      <div class="typing-indicator" id="typing-indicator">
        <div class="typing-dot"></div>
        <div class="typing-dot"></div>
        <div class="typing-dot"></div>
      </div>
    </div>
    <div id="reply-preview" style="display:none;padding:6px 12px;background:var(--bg3);border-left:3px solid var(--accent2);margin:0 12px;border-radius:0 6px 6px 0;font-size:0.82em;color:var(--fg2);display:none;align-items:center;gap:8px">
      <span id="reply-preview-text" style="flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap"></span>
      <button onclick="clearReply()" style="background:none;border:none;color:var(--fg2);cursor:pointer;font-size:1.1em;padding:0 4px">âœ•</button>
    </div>
    <div id="file-preview" style="display:none;padding:6px 12px;background:var(--bg3);border-radius:6px;margin:0 12px;font-size:0.82em;color:var(--fg2);align-items:center;gap:8px">
      <span id="file-preview-text" style="flex:1"></span>
      <button onclick="clearFileUpload()" style="background:none;border:none;color:var(--fg2);cursor:pointer;font-size:1.1em;padding:0 4px">âœ•</button>
    </div>
    <div class="input-area">
      <label for="file-upload" style="cursor:pointer;font-size:1.3em;padding:4px 8px;opacity:0.6;transition:opacity 0.2s" title="Datei anhÃ¤ngen">ğŸ“</label>
      <input type="file" id="file-upload" style="display:none" onchange="handleFileSelect(this.files)">
      <textarea id="chat-input" placeholder="Nachricht eingeben... (Enter = senden, Shift+Enter = Zeile)" rows="1"></textarea>
      <button class="btn-send" id="send-btn" onclick="sendMessage()">Senden â†µ</button>
    </div>
  </div>

  <!-- Dashboard -->
  <div class="page content" id="page-dashboard">
    <div class="cards" id="dashboard-cards"></div>
  </div>

  <!-- Models -->
  <div class="page content" id="page-models">
    <div id="models-setup"></div>
  </div>

  <!-- Personality -->
  <div class="page content" id="page-personality">
    <div class="card" style="max-width:700px">
      <h3>ğŸ­ PersÃ¶nlichkeit (SOUL.md)</h3>
      <div class="sub" style="margin-bottom:12px">Definiert wie Alvin Bot spricht und sich verhÃ¤lt. Ã„nderungen werden sofort aktiv.</div>
      <textarea class="editor" id="soul-editor" style="min-height:300px" placeholder="SOUL.md laden..."></textarea>
      <div style="margin-top:12px;display:flex;gap:8px">
        <button class="btn" onclick="saveSoul()">ğŸ’¾ Speichern & Aktivieren</button>
        <button class="btn btn-outline" onclick="loadPersonality()">â†» Neu laden</button>
      </div>
    </div>
  </div>

  <!-- Memory -->
  <div class="page content" id="page-memory">
    <div class="editor-toolbar">
      <select id="memory-file" onchange="loadMemoryFile()"></select>
      <button class="btn btn-sm" onclick="saveMemoryFile()">ğŸ’¾ Speichern</button>
    </div>
    <textarea class="editor" id="memory-editor" placeholder="Datei auswÃ¤hlen..."></textarea>
  </div>

  <!-- Sessions -->
  <div class="page content" id="page-sessions">
    <div id="sessions-list"></div>
  </div>

  <!-- Files -->
  <div class="page content" id="page-files">
    <div class="editor-toolbar">
      <span id="file-breadcrumb" style="flex:1;color:var(--fg2);font-size:0.85em">ğŸ“ /</span>
      <button class="btn btn-sm btn-outline" onclick="createNewFile()">ğŸ“ Neue Datei</button>
      <button class="btn btn-sm btn-outline" onclick="navigateFiles('..')">â¬†ï¸ Hoch</button>
    </div>
    <div id="file-list"></div>
    <div id="file-editor-area" style="display:none;margin-top:16px">
      <div class="editor-toolbar">
        <span id="file-edit-name" style="flex:1;color:var(--accent2);font-family:monospace;font-size:0.85em"></span>
        <button class="btn btn-sm" onclick="saveFile()">ğŸ’¾ Speichern</button>
        <button class="btn btn-sm btn-outline" style="color:var(--red)" onclick="deleteFile(document.getElementById('file-edit-name').textContent)">ğŸ—‘ï¸</button>
        <button class="btn btn-sm btn-outline" onclick="document.getElementById('file-editor-area').style.display='none'">âœ•</button>
      </div>
      <textarea class="editor" id="file-editor"></textarea>
    </div>
  </div>

  <!-- Cron -->
  <div class="page content" id="page-cron">
    <div style="display:flex;align-items:center;gap:12px;margin-bottom:16px">
      <div style="flex:1">
        <h3 style="font-size:1em;margin-bottom:4px">â° Cron Jobs</h3>
        <div class="sub">Geplante wiederkehrende oder einmalige Aufgaben.</div>
      </div>
      <button class="btn btn-sm" onclick="showCreateCron()">+ Job erstellen</button>
    </div>
    <div id="cron-create-form" style="display:none;margin-bottom:16px;padding:16px;background:var(--bg2);border:1px solid var(--bg3);border-radius:var(--radius)">
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:12px">
        <input id="cron-name" placeholder="Name (z.B. Health Check)" class="input">
        <select id="cron-type" class="input">
          <option value="reminder">â° Reminder</option>
          <option value="shell">âš¡ Shell Command</option>
          <option value="http">ğŸŒ HTTP Request</option>
          <option value="message">ğŸ’¬ Nachricht</option>
          <option value="ai-query">ğŸ¤– AI Query</option>
        </select>
      </div>
      <div id="cron-create-schedule-builder"></div>
      <div style="margin-bottom:8px">
        <input id="cron-payload" placeholder="Payload (Text, Command, URL, Prompt)" class="input" style="width:100%">
      </div>
      <div style="display:flex;gap:8px">
        <button class="btn btn-sm" onclick="createCronJob()">ğŸ’¾ Erstellen</button>
        <button class="btn btn-sm btn-outline" onclick="document.getElementById('cron-create-form').style.display='none'">Abbrechen</button>
      </div>
    </div>
    <div id="cron-list"></div>
  </div>

  <!-- Tools -->
  <div class="page content" id="page-tools">
    <div style="margin-bottom:16px;display:flex;gap:8px;align-items:center;flex-wrap:wrap">
      <input type="text" id="tools-search" placeholder="ğŸ” Tool suchen..." style="flex:1;min-width:200px;background:var(--bg3);border:1px solid var(--bg3);border-radius:var(--radius-sm);padding:8px 12px;color:var(--fg);font:inherit;font-size:0.85em;outline:none" oninput="filterTools()">
      <span class="badge badge-accent" id="tools-count">0 Tools</span>
    </div>
    <div id="tools-list"></div>
  </div>

  <!-- Plugins -->
  <div class="page content" id="page-plugins">
    <div id="plugins-list"></div>
  </div>

  <!-- Platforms -->
  <div class="page content" id="page-platforms">
    <div id="platforms-setup"></div>
  </div>

  <!-- Users -->
  <div class="page content" id="page-users">
    <div id="users-list"></div>
  </div>

  <!-- Terminal -->
  <div class="page" id="page-terminal" style="flex-direction:column;height:100%">
    <div class="content" style="flex:1;display:flex;flex-direction:column">
      <div class="terminal-output" id="terminal-output" style="flex:1"></div>
      <div style="display:flex;gap:8px;margin-top:12px;align-items:center">
        <span style="color:var(--accent);font-family:monospace;font-weight:bold">$</span>
        <textarea id="terminal-input" placeholder="Befehl eingeben..." rows="1" style="flex:1;background:var(--bg3);border:1px solid transparent;border-radius:8px;padding:10px;color:var(--fg);font-family:'SF Mono',Monaco,monospace;font-size:0.85em;resize:none;outline:none;min-height:40px" ></textarea>
        <button class="btn" onclick="runCommand()">Run</button>
      </div>
    </div>
  </div>

  <!-- Maintenance -->
  <div class="page content" id="page-maintenance">
    <div id="maintenance-content"><div style="color:var(--fg2)">Lade...</div></div>
  </div>

  <!-- Settings -->
  <div class="page content" id="page-settings">
    <div id="settings-content"></div>
  </div>
</div>

<script src="/js/app.js"></script>
</body>
</html>
