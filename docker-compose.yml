# ─────────────────────────────────────────────────────────────
# Alvin Bot — Docker Compose (Production)
#
# Quick start:
#   cp .env.example .env   # Edit with your API keys
#   docker compose up -d   # Start in background
#   docker compose logs -f # View logs
# ─────────────────────────────────────────────────────────────

services:
  alvin-bot:
    build: .
    container_name: alvin-bot
    restart: unless-stopped
    env_file: .env

    # ── Volumes ───────────────────────────────────────────────
    volumes:
      # Persistent data (memory, sessions, cron jobs)
      - ./data:/app/data
      # Memory / docs
      - ./docs:/app/docs
      # Personality files (read-only)
      - ./SOUL.md:/app/SOUL.md:ro
      - ./CLAUDE.md:/app/CLAUDE.md:ro

    # ── Environment ───────────────────────────────────────────
    environment:
      - NODE_ENV=production

    # ── Ports ─────────────────────────────────────────────────
    # Web UI
    ports:
      - "3100:3100"

    # ── Health Check ──────────────────────────────────────────
    healthcheck:
      test: ["CMD", "node", "-e", "process.exit(0)"]
      interval: 30s
      timeout: 5s
      start_period: 10s
      retries: 3

  # ── Development profile ───────────────────────────────────
  alvin-bot-dev:
    build:
      context: .
      target: builder
    container_name: alvin-bot-dev
    profiles: ["dev"]
    env_file: .env
    volumes:
      - ./src:/app/src
      - ./docs:/app/docs
      - ./data:/app/data
    environment:
      - NODE_ENV=development
    ports:
      - "3100:3100"
    command: ["npx", "tsx", "src/index.ts"]
